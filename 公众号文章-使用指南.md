# MCP 三大核心概念实战演示

## 前言

Model Context Protocol (MCP) 是一个开放协议，让 AI 应用能够安全地连接到外部数据源和工具。本文通过三个实际案例，深入讲解 MCP 的三大核心概念。

---

## 一、Tools（工具）- 让 AI 拥有"手脚"

### 概念解析

**Tools** 允许 Claude 主动调用外部功能来执行操作。这就像给 AI 装上了"手脚"，让它不仅能思考，还能行动。

### 实现原理

```
用户请求 → Claude 分析 → 选择工具 → 调用 MCP Server → 返回结果 → Claude 整合回答
```

### 代码示例

#### 1. 定义工具清单

```javascript
server.setRequestHandler(ListToolsRequestSchema, async () => {
  return {
    tools: [
      {
        name: 'calculate',
        description: '执行基本的数学计算（加、减、乘、除）',
        inputSchema: {
          type: 'object',
          properties: {
            operation: {
              type: 'string',
              enum: ['add', 'subtract', 'multiply', 'divide'],
            },
            a: { type: 'number' },
            b: { type: 'number' },
          },
          required: ['operation', 'a', 'b'],
        },
      },
    ],
  };
});
```

#### 2. 处理工具调用

```javascript
server.setRequestHandler(CallToolRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;

  if (name === 'calculate') {
    const { operation, a, b } = args;
    let result;

    switch (operation) {
      case 'add': result = a + b; break;
      case 'subtract': result = a - b; break;
      case 'multiply': result = a * b; break;
      case 'divide': result = a / b; break;
    }

    return {
      content: [{
        type: 'text',
        text: `计算结果: ${a} ${operation} ${b} = ${result}`
      }],
    };
  }
});
```

### 实际效果

```
👤 用户: 帮我计算 123 + 456

🤖 Claude:
[调用 calculate 工具]
→ operation: "add"
→ a: 123
→ b: 456

计算结果：123 + 456 = 579
```

### 应用场景

- ✅ 数据库 CRUD 操作
- ✅ 发送邮件/短信通知
- ✅ 文件系统操作
- ✅ 调用第三方 API

---

## 二、Resources（资源）- 为 AI 提供"知识库"

### 概念解析

**Resources** 允许 Claude 访问外部数据源，获取实时上下文信息。这就像给 AI 配备了"图书馆"，让它能查阅最新的资料。

### 实现原理

```
Claude 需要信息 → 列出可用资源 → 选择资源 → 读取内容 → 整合到回答
```

### 代码示例

#### 1. 列出可用资源

```javascript
server.setRequestHandler(ListResourcesRequestSchema, async () => {
  return {
    resources: [
      {
        uri: 'data://users',
        name: '用户列表',
        description: '系统中所有用户的信息',
        mimeType: 'application/json',
      },
      {
        uri: 'data://products',
        name: '产品目录',
        description: '所有可用产品的列表和价格',
        mimeType: 'application/json',
      },
    ],
  };
});
```

#### 2. 读取资源内容

```javascript
server.setRequestHandler(ReadResourceRequestSchema, async (request) => {
  const { uri } = request.params;

  if (uri === 'data://users') {
    const users = [
      { id: 1, name: '张三', role: '开发工程师' },
      { id: 2, name: '李四', role: '产品经理' },
    ];

    return {
      contents: [{
        uri,
        mimeType: 'application/json',
        text: JSON.stringify(users, null, 2),
      }],
    };
  }
});
```

### 实际效果

```
👤 用户: 显示所有用户列表

🤖 Claude:
[访问 data://users 资源]

当前系统中有以下用户：
1. 张三 - 开发工程师
2. 李四 - 产品经理
```

### 关键特点

| 特性 | 说明 |
|------|------|
| 只读 | Resources 通常是只读的，不修改数据 |
| URI 标识 | 每个资源都有唯一的 URI |
| 结构化 | 支持 JSON、文本、二进制等格式 |
| 动态 | 数据可以是实时的 |

### 应用场景

- ✅ 访问文件系统
- ✅ 查询数据库数据
- ✅ 获取 API 响应
- ✅ 读取配置信息

---

## 三、Prompts（提示模板）- 标准化 AI 工作流

### 概念解析

**Prompts** 提供预定义的提示模板，将最佳实践固化为可重用的模板。这就像给 AI 准备了"标准操作手册"。

### 实现原理

```
用户选择模板 → 填入参数 → MCP 生成完整提示 → Claude 执行 → 返回标准化结果
```

### 代码示例

#### 1. 定义提示模板列表

```javascript
server.setRequestHandler(ListPromptsRequestSchema, async () => {
  return {
    prompts: [
      {
        name: 'code_review',
        description: '对代码进行全面的审查',
        arguments: [
          {
            name: 'code',
            description: '要审查的代码',
            required: true,
          },
          {
            name: 'language',
            description: '编程语言',
            required: true,
          },
        ],
      },
    ],
  };
});
```

#### 2. 生成提示内容

```javascript
server.setRequestHandler(GetPromptRequestSchema, async (request) => {
  const { name, arguments: args } = request.params;

  if (name === 'code_review') {
    const { code, language } = args;

    return {
      messages: [
        {
          role: 'user',
          content: {
            type: 'text',
            text: `请对以下 ${language} 代码进行全面审查：

\`\`\`${language}
${code}
\`\`\`

请从以下几个方面进行审查：
1. 代码质量：可读性、命名规范
2. 性能问题：潜在瓶颈
3. 安全性：可能的漏洞
4. 最佳实践：是否遵循规范
5. Bug 风险：可能导致问题的代码

请提供具体的改进建议。`,
          },
        },
      ],
    };
  }
});
```

### 实际效果

```
👤 用户: [选择"代码审查"模板]
       语言: JavaScript
       代码: function add(a,b){return a+b}

🤖 Claude:
[使用 code_review 模板]

代码审查报告：

1. 代码质量 ⭐⭐⭐
   - 缺少参数类型检查
   - 建议使用 const 而非 function

2. 性能问题 ✅
   - 无明显性能问题

3. 安全性 ⚠️
   - 建议添加参数验证

改进建议：
const add = (a, b) => {
  if (typeof a !== 'number' || typeof b !== 'number') {
    throw new TypeError('参数必须是数字');
  }
  return a + b;
};
```

### 模板优势

| 优势 | 说明 |
|------|------|
| 标准化 | 统一团队的工作流程 |
| 可重用 | 一次定义，多次使用 |
| 参数化 | 灵活适应不同场景 |
| 质量保证 | 确保关键步骤不遗漏 |

### 应用场景

- ✅ 代码审查流程
- ✅ 文档生成模板
- ✅ Bug 分析框架
- ✅ API 设计指南

---

## 四、三者对比

| 维度 | Tools | Resources | Prompts |
|------|-------|-----------|---------|
| **核心作用** | 执行操作 | 提供数据 | 标准化任务 |
| **数据流向** | Claude → 外部系统 | 外部系统 → Claude | 模板 → Claude |
| **是否修改状态** | ✅ 是 | ❌ 否（只读） | ❌ 否 |
| **使用时机** | 需要执行动作时 | 需要查询信息时 | 需要标准流程时 |
| **实现复杂度** | 中 | 低 | 低 |
| **示例** | 发送邮件 | 查询用户 | 代码审查模板 |

---

## 五、完整示例：构建一个项目管理助手

结合三个概念，我们可以构建一个强大的项目管理助手：

### Tools（工具）
- `create_task` - 创建新任务
- `update_status` - 更新任务状态
- `assign_user` - 分配任务给用户

### Resources（资源）
- `project://tasks` - 所有任务列表
- `project://users` - 团队成员信息
- `project://milestones` - 项目里程碑

### Prompts（模板）
- `sprint_planning` - Sprint 计划模板
- `daily_standup` - 每日站会模板
- `retrospective` - 回顾会议模板

### 使用场景

```
👤 PM: 使用 sprint_planning 模板开始新的 Sprint

🤖 Claude:
[读取 project://tasks 资源]
[读取 project://users 资源]
[应用 sprint_planning 模板]

根据当前 20 个待办任务和 5 位团队成员，
建议本 Sprint 安排如下：

高优先级任务（8个）：
- [使用 create_task 工具创建...]
- [使用 assign_user 工具分配...]

中优先级任务（7个）：
...

建议的 Sprint 目标：完成用户认证模块
```

---

## 六、最佳实践

### Tools 设计原则

1. **单一职责**：每个工具只做一件事
2. **幂等性**：相同输入产生相同结果
3. **错误处理**：提供清晰的错误信息
4. **验证输入**：严格验证参数

### Resources 设计原则

1. **URI 规范**：使用清晰的命名规则
2. **缓存策略**：考虑数据更新频率
3. **权限控制**：保护敏感数据
4. **格式统一**：使用标准的数据格式

### Prompts 设计原则

1. **清晰结构**：明确的步骤和要求
2. **参数化**：灵活适应不同场景
3. **示例丰富**：提供足够的上下文
4. **持续优化**：根据使用反馈改进

---

## 七、总结

MCP 的三大核心概念各司其职：

- **Tools** = AI 的"手脚"，让它能执行操作
- **Resources** = AI 的"图书馆"，让它能获取信息
- **Prompts** = AI 的"操作手册"，让它能标准化工作

通过组合使用这三个概念，我们可以构建强大、灵活、可维护的 AI 应用。

---

## 八、获取完整代码

本文所有示例代码已开源，包含：
- ✅ 3 个完整的 MCP Server 实现
- ✅ 详细的配置说明
- ✅ 使用示例和测试用例

项目地址：`~/mcp-demos/`

---

## 九、延伸阅读

- [MCP 官方规范](https://modelcontextprotocol.io)
- [MCP SDK 文档](https://github.com/modelcontextprotocol/sdk)
- [更多 MCP Server 示例](https://github.com/modelcontextprotocol/servers)

---

**关注公众号，获取更多 AI 开发实战内容！**
